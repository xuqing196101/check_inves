<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="yggc.dao.bms.PreMenuMapper">
  <resultMap id="MenuResultMap" type="yggc.model.bms.PreMenu">
    <result column="ID" property="id" />
    <result column="NAME" property="name" />
    <result column="TYPE" property="type" />
    <result column="IS_DELETED" property="isDeleted" />
    <result column="STATE" property="state" />
    <result column="URL" property="url" />
    <result column="CREATED_AT" jdbcType="TIMESTAMP" property="createdAt" />
    <result column="ORDERBY" property="orderby" />
    <result column="MENULEVEL" property="menulevel" />
     <!-- 查询创建人 -->  
    <association column="PARENT_ID"  property="parentId" select="queryById" /> 
  </resultMap>
  
  <resultMap type="yggc.model.bms.PreMenu" id="rolemenuMap" extends="MenuResultMap">  
    <!-- property: 指的是集合属性的值, ofType：指的是集合中元素的类型-->
	<collection property="roles" ofType="yggc.model.bms.Role">
		<id column="roleId"  property="id" />
	    <result column="roleName" jdbcType="VARCHAR" property="name" />
	    <result column="roleCreatedAt" jdbcType="TIMESTAMP" property="createdAt" />
	    <result column="describe" jdbcType="VARCHAR" property="describe" />
	    <result column="roleIsDeleted" property="isDeleted" />
	</collection>   
  </resultMap> 
  
  <sql id="Tabel_Name">
    T_SES_BMS_PERMENU
  </sql>
  <!-- 表中所有列 -->
  <sql id="Base_Column_List" >
   ID,NAME,TYPE,IS_DELETED,STATE,URL,CREATED_AT,ORDERBY,MENULEVEL,PARENT_ID
  </sql>
  
  <select id="queryById" resultMap="MenuResultMap" parameterType="Object">
    select
    <include refid="Base_Column_List" />
    from T_SES_BMS_PERMENU where ID = #{id}
  </select>
  
  <insert id="insert" parameterType="yggc.model.bms.PreMenu">
    insert into T_SES_BMS_PERMENU (ID, NAME, TYPE, 
      IS_DELETED, STATE, URL, 
      CREATED_AT, ORDERBY, MENULEVEL, 
      PARENT_ID)
    values (#{id,jdbcType=DECIMAL}, #{name,jdbcType=VARCHAR}, #{type,jdbcType=VARCHAR}, 
      #{isDeleted,jdbcType=DECIMAL}, #{state,jdbcType=DECIMAL}, #{url,jdbcType=VARCHAR}, 
      #{createdAt,jdbcType=DATE}, #{orderby,jdbcType=DECIMAL}, #{menulevel,jdbcType=DECIMAL}, 
      #{parentId,jdbcType=DECIMAL})
  </insert>
  <insert id="insertSelective" parameterType="yggc.model.bms.PreMenu">
    insert into T_SES_BMS_PERMENU
    <trim prefix="(" suffix=")" suffixOverrides=",">
      <if test="id != null">
        ID,
      </if>
      <if test="name != null">
        NAME,
      </if>
      <if test="type != null">
        TYPE,
      </if>
      <if test="isDeleted != null">
        IS_DELETED,
      </if>
      <if test="state != null">
        STATE,
      </if>
      <if test="url != null">
        URL,
      </if>
      <if test="createdAt != null">
        CREATED_AT,
      </if>
      <if test="orderby != null">
        ORDERBY,
      </if>
      <if test="menulevel != null">
        MENULEVEL,
      </if>
      <if test="parentId != null">
        PARENT_ID,
      </if>
    </trim>
    <trim prefix="values (" suffix=")" suffixOverrides=",">
      <if test="id != null">
        #{id,jdbcType=DECIMAL},
      </if>
      <if test="name != null">
        #{name,jdbcType=VARCHAR},
      </if>
      <if test="type != null">
        #{type,jdbcType=VARCHAR},
      </if>
      <if test="isDeleted != null">
        #{isDeleted,jdbcType=DECIMAL},
      </if>
      <if test="state != null">
        #{state,jdbcType=DECIMAL},
      </if>
      <if test="url != null">
        #{url,jdbcType=VARCHAR},
      </if>
      <if test="createdAt != null">
        #{createdAt,jdbcType=DATE},
      </if>
      <if test="orderby != null">
        #{orderby,jdbcType=DECIMAL},
      </if>
      <if test="menulevel != null">
        #{menulevel,jdbcType=DECIMAL},
      </if>
      <if test="parentId != null">
        #{parentId,jdbcType=DECIMAL},
      </if>
    </trim>
  </insert>
  <!-- 根据roleid查询权限菜单和角色信息 -->  
  <select id="selectRolePreMenu" parameterType="Object"  
      resultMap="rolemenuMap">  
      select 
      pm.*,
      r.ID as roleId,r.NAME as roleName,r.CREATED_AT as roleCreatedAt,r.DESCRIBE as describe,r.IS_DELETED as roleIsDeleted 
      from 
      T_SES_BMS_PERMENU pm left join T_SES_BMS_ROLEPERMISSION rp 
      on pm.ID=rp."PERMENU_ID"  
      left join T_SES_BMS_ROLEMAN r 
      on rp."ROLE_ID"=r.ID
      where 
      pm.IS_DELETED=0 
      <if test="id!= null">
        and pm.ID = #{id}  
      </if> 
      ORDER BY pm.ORDERBY DESC
  </select>  
  <!-- 保存权限和角色之间的关系信息 -->  
  <insert id="saveRelativity" parameterType="Object">  
      insert into T_SES_BMS_ROLEPERMISSION("PERMENU_ID","ROLE_ID")  
      values(#{preMenu.id},#{role.id})  
  </insert>
</mapper>