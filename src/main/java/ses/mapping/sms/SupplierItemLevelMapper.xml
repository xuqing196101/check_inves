<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd" >
<mapper namespace="ses.dao.sms.SupplierItemLevelMapper" >
  <resultMap id="BaseResultMap" type="ses.model.sms.SupplierItemLevel" >
    <id column="ID" property="id" jdbcType="VARCHAR" />
    <result column="SUPPLIER_ID" property="supplierId" jdbcType="VARCHAR" />
    <result column="SUPPLIER_LEVEL" property="supplierLevel" jdbcType="VARCHAR" />
    <result column="CATEGORY_ID" property="categoryId" jdbcType="VARCHAR" />
    <result column="CREATED_AT" property="createdAt" jdbcType="TIMESTAMP" />
    <result column="SUPPLIER_TYPE_ID" property="supplierTypeId" jdbcType="VARCHAR" />
  </resultMap>
  <sql id="Base_Column_List" >
    ID, SUPPLIER_ID, SUPPLIER_LEVEL, CATEGORY_ID, CREATED_AT, SUPPLIER_TYPE_ID
  </sql>
   <sql id="lBase_Column_List" >
    l.SUPPLIER_ID as supplierId, l.SUPPLIER_LEVEL as supplierLevel, 
    l.CATEGORY_ID categoryId, l.CREATED_AT as createdAt, l.SUPPLIER_TYPE_ID as supplierTypeId,
    s.SUPPLIER_NAME as supplierName,
    s.ARMY_BUSINESS_NAME as armyBusinessName,
    s.ARMY_BUSINESS_TELEPHONE as armyBuinessTelephone,org.SHORT_NAME as orgName
  </sql>
  <select id="selectByCategoryId" resultMap="BaseResultMap" parameterType="java.lang.String" >
    SELECT <include refid="lBase_Column_List" />
    from T_SES_SMS_SUPPLIER_ITEM_LEVEL l LEFT JOIN T_SES_SMS_SUPPLIER s
        LEFT JOIN T_SES_OMS_PURCHASE_DEP dep ON s.PROCUREMENT_DEP_ID = dep.ID
        LEFT JOIN T_SES_OMS_ORG org ON org.ID = dep.ORG_ID
        ON l.SUPPLIER_ID=s.ID
        where l.CATEGORY_ID = #{categoryId,jdbcType=VARCHAR}
        <if test="supplierName != null and supplierName !=''">
                and s.SUPPLIER_NAME like CONCAT(CONCAT('%', #{supplierName}), '%')
            </if>
            <if test="armyBusinessName != null and armyBusinessName != ''">
                AND s.ARMY_BUSINESS_NAME like CONCAT(CONCAT('%', #{armyBusinessName}), '%')
            </if>
        ORDER BY s.supplier_name
  </select>
  <!-- 判断是否存在  -->
   <select id="countItemLevel" resultMap="BaseResultMap" parameterType="java.lang.String" >
    select 
    count(ID)
    from T_SES_SMS_SUPPLIER_ITEM_LEVEL
    where SUPPLIER_ID = #{supplierId,jdbcType=VARCHAR} 
    and SUPPLIER_TYPE_ID=#{supplierTypeId,jdbcType=VARCHAR}
  </select>
  
  <delete id="deleteByCategoryIdType" parameterType="java.lang.String" >
    delete from T_SES_SMS_SUPPLIER_ITEM_LEVEL
    where CATEGORY_ID = #{categoryId,jdbcType=VARCHAR} 
    and SUPPLIER_TYPE_ID=#{supplierTypeId,jdbcType=VARCHAR}
  </delete>
  <insert id="insert" parameterType="ses.model.sms.SupplierItemLevel" >
    insert into T_SES_SMS_SUPPLIER_ITEM_LEVEL (ID, SUPPLIER_ID, SUPPLIER_LEVEL, 
      CATEGORY_ID, CREATED_AT, SUPPLIER_TYPE_ID
      )
    values (#{id,jdbcType=VARCHAR}, #{supplierId,jdbcType=VARCHAR}, #{supplierLevel,jdbcType=VARCHAR}, 
      #{categoryId,jdbcType=VARCHAR}, #{createdAt,jdbcType=TIMESTAMP}, 
      #{supplierTypeId,jdbcType=VARCHAR}
      )
  </insert>
  <insert id="insertSelective" parameterType="ses.model.sms.SupplierItemLevel" >
  <selectKey keyProperty="id" resultType="String" order="BEFORE">
        select sys_guid() from dual
    </selectKey>
    insert into T_SES_SMS_SUPPLIER_ITEM_LEVEL
    <trim prefix="(" suffix=")" suffixOverrides="," >
      <if test="id != null" >
        ID,
      </if>
      <if test="supplierId != null" >
        SUPPLIER_ID,
      </if>
      <if test="supplierLevel != null" >
        SUPPLIER_LEVEL,
      </if>
      <if test="categoryId != null" >
        CATEGORY_ID,
      </if>
      <if test="createdAt != null" >
        CREATED_AT,
      </if>
      <if test="supplierTypeId != null" >
        SUPPLIER_TYPE_ID,
      </if>
       
    </trim>
    <trim prefix="values (" suffix=")" suffixOverrides="," >
      <if test="id != null" >
        #{id,jdbcType=VARCHAR},
      </if>
      <if test="supplierId != null" >
        #{supplierId,jdbcType=VARCHAR},
      </if>
      <if test="supplierLevel != null" >
        #{supplierLevel,jdbcType=VARCHAR},
      </if>
      <if test="categoryId != null" >
        #{categoryId,jdbcType=VARCHAR},
      </if>
      <if test="createdAt != null" >
        #{createdAt,jdbcType=TIMESTAMP},
      </if>
      <if test="supplierTypeId != null" >
        #{supplierTypeId,jdbcType=VARCHAR},
      </if>
      
    </trim>
  </insert>
  <update id="updateByPrimaryKeyBySupplierIdTypeID" parameterType="ses.model.sms.SupplierItemLevel" >
    update T_SES_SMS_SUPPLIER_ITEM_LEVEL
    <set >
      <if test="supplierId != null" >
        SUPPLIER_ID = #{supplierId,jdbcType=VARCHAR},
      </if>
      <if test="supplierLevel != null" >
        SUPPLIER_LEVEL = #{supplierLevel,jdbcType=VARCHAR},
      </if>
      <if test="categoryId != null" >
        CATEGORY_ID = #{categoryId,jdbcType=VARCHAR},
      </if>
      <if test="createdAt != null" >
        CREATED_AT = #{createdAt,jdbcType=TIMESTAMP},
      </if>
      <if test="supplierTypeId != null" >
        SUPPLIER_TYPE_ID = #{supplierTypeId,jdbcType=VARCHAR},
      </if>
       
    </set>
    where SUPPLIER_ID = #{supplierId,jdbcType=VARCHAR} 
    and SUPPLIER_TYPE_ID=#{supplierTypeId,jdbcType=VARCHAR}
  </update>
  <update id="updateByPrimaryKey" parameterType="ses.model.sms.SupplierItemLevel" >
    update T_SES_SMS_SUPPLIER_ITEM_LEVEL
    set SUPPLIER_ID = #{supplierId,jdbcType=VARCHAR},
      SUPPLIER_LEVEL = #{supplierLevel,jdbcType=VARCHAR},
      CATEGORY_ID = #{categoryId,jdbcType=VARCHAR},
      CREATED_AT = #{createdAt,jdbcType=TIMESTAMP},
      SUPPLIER_TYPE_ID = #{supplierTypeId,jdbcType=VARCHAR},
     where ID = #{id,jdbcType=VARCHAR}
  </update>
</mapper>